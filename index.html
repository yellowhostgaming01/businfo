<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Businfo</title>
    <link rel="stylesheet" href="assets/lib/custom/custom.css" />
    <link rel="stylesheet" href="assets/fonts/opfonts/style.css" />
    <link rel="stylesheet" href="assets/bundle/app.bundle.css" />
  </head>

  <body>
    <header class="header" style="opacity: 1; visibility: visible">
      <span class="menu-icon" onclick=""><i class="opf opf-menu"></i></span>
      <div class="header-area section" id="header-area">
        <div class="widget Header" id="Header1">
          <div id="header-inner">
            <div class="titlewrapper">
              <h1 class="title">Businfo</h1>
            </div>
          </div>
        </div>
        <div class="widget LinkList" id="LinkList3">
          <div>
            <div class="nav-head">
              <h1>BusInfo</h1>
              <span class="menu-close"><i class="opf opf-clear"></i></span>
            </div>
            <div id="dropmenu">
              <ul id="menu1">
                <li><a href="#" open-window="setting-page">Setting</a></li>
                <li><a>Login</a></li>
              </ul>
            </div>
            <div class="clear"></div>
          </div>
        </div>
      </div>
      <span><i class="opf opf-share"></i></span>
      <div class="webSite"></div>
      <span><i class="opf opf-search"></i></span>
    </header>
    <div id="search-box">
      <input
        name="q"
        placeholder="Search...."
        type="search"
        value="selecturlsOfImages"
      />
      <span class="closebtn" onclick="closeSearch()">&#215;</span>
    </div>

    <!-- <div class="breadcrumb-navigation-main">
    <div class="bcn">
      <span pageURL="">Home</span><i class="yhgi yhgi-chevron-right-24"></i>
    </div>
  </div> -->

    <div class="contant-main">
      <div class="indrodunction">
        <!-- <h2>Bus Info</h2> -->
      </div>
    </div>

    <!--tabs-->
    <div class="tabs-main-table" bcnavigation="Home">
      <div class="tabs-tab1" work="search_busses">
        <i class="opf-search opf"></i>
        <br />
        <span>Search Bus</span>
      </div>
      <yhg-devider-center></yhg-devider-center>
      <div class="tabs-tab2">
        <i class="opf opf-add_call"></i>
        <br />
        <span>Bus Helpline</span>
      </div>
      <br />
      <yhg-bottom></yhg-bottom>
      <div class="tabs-tab3">
        <i class="opf-business opf"></i>
        <br />
        <span>Cities</span>
      </div>
      <yhg-devider-center></yhg-devider-center>
      <div class="tabs-tab4">
        <i class="opf opf-commute"></i>
        <br />
        <span>Vehicle Details</span>
      </div>
    </div>

    <div class="form-data-main-table"></div>
  </body>
  <script src="assets/bundle/data.fetching.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
    } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAHP-EQhADXl9ZjtG1MgDrcQn9rK6mSrjs",
      authDomain: "businfo-yhgindian.firebaseapp.com",
      projectId: "businfo-yhgindian",
      storageBucket: "businfo-yhgindian.firebasestorage.app",
      messagingSenderId: "108457341569",
      appId: "1:108457341569:web:4cb2c4ee15c61c9c195380",
      measurementId: "G-DW7H5KPDPX",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Fetch Bus Data
    async function fetchBusData() {
      const busCol = collection(db, "BusInfo");
      const busSnapshot = await getDocs(busCol);

      const busListRaw = busSnapshot.docs.map((doc) => ({
        id: doc.id,
        ...doc.data(),
      }));

      const bus_data = busListRaw.map((bus) => ({
        vendor: bus.Vendor || "",
        from: bus.From || "",
        to: bus.To || "",
        stops: (bus.Stops || []).map((s) => ({
          name: s.Station || "",
          timings: [s.Arrival || "", s.Departure || ""],
          distance: s.Distance || "",
        })),
        timings: bus.Time || [],
        route: bus.Route || "",
        handler: bus.Depot || "",
      }));

      window.bus_data = bus_data; // global variable
      return bus_data;
    }

    // Fetch Cities Data
    async function fetchCities() {
      const cityCol = collection(db, "CityInfo");
      const citySnapshot = await getDocs(cityCol);

      const cityListRaw = citySnapshot.docs.map((doc) => ({
        id: doc.id,
        ...doc.data(),
      }));

      const cities = cityListRaw.map((city) => ({
        name: city.CityName || "",
        code: city.CityCode || "",
      }));

      window.cities = cities; // global variable
      return cities;
    }

    // Call both functions
    fetchBusData();
    fetchCities();
  </script>

  <script src="assets/lib/yhgquery.js"></script>
  <script src="assets/lib/custom/custom.js"></script>
  <script src="assets/bundle/app.bundle.js"></script>
</html>
